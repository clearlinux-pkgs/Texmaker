From f2029cb1b2e5f4015fc313c74e7e131d73514f60 Mon Sep 17 00:00:00 2001
From: mayeut <mayeut@users.noreply.github.com>
Date: Wed, 28 Aug 2019 22:02:05 -0700
Subject: [PATCH] Fix division by zero

Fix uclouvain/openjpeg#733
---
 pdfium/third_party/libopenjpeg20/tcd.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/pdfium/third_party/libopenjpeg20/tcd.c b/pdfium/third_party/libopenjpeg20/tcd.c
index 217b2c0..4057290 100644
--- a/pdfium/third_party/libopenjpeg20/tcd.c
+++ b/pdfium/third_party/libopenjpeg20/tcd.c
@@ -733,7 +733,8 @@ static INLINE OPJ_BOOL opj_tcd_init_tile(opj_tcd_t *p_tcd, OPJ_UINT32 p_tile_no,
 		}
 		/* compute l_data_size with overflow check */
 		l_data_size = (OPJ_UINT32)(l_tilec->x1 - l_tilec->x0);
-		if ((((OPJ_UINT32)-1) / l_data_size) < (OPJ_UINT32)(l_tilec->y1 - l_tilec->y0)) {
+		/* issue 733, l_data_size == 0U, probably something wrong should be checked before getting here */
+		if ((l_data_size > 0U) && ((((OPJ_UINT32)-1) / l_data_size) < (OPJ_UINT32)(l_tilec->y1 - l_tilec->y0))) {
 			opj_event_msg(manager, EVT_ERROR, "Not enough memory for tile data\n");
 			return OPJ_FALSE;
 		}
-- 
2.23.0

